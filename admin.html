<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin JSON Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Outfit', sans-serif; background-color: #09090b; color: #fff; }
        .glass-card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        input[type="text"] { background: rgba(0,0,0,0.3); border: 1px solid #333; color: white; }
    </style>
</head>
<body class="p-5 md:p-10">

    <div class="max-w-4xl mx-auto">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-[#DB2777]">Song Manager (No PHP)</h1>
            <button onclick="downloadJSON()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-bold shadow-lg animate-pulse">
                Download Updated songs.json
            </button>
        </div>

        <!-- Add New Song Form -->
        <div class="glass-card p-6 rounded-2xl mb-8">
            <h2 class="text-xl font-semibold mb-4 text-gray-200">Add New Song</h2>
            <form id="songForm" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Song Title</label>
                        <input type="text" id="title" required placeholder="e.g. Diljit Song" class="w-full p-2 rounded-lg focus:outline-none focus:border-[#DB2777]">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Artist Name</label>
                        <input type="text" id="artist" required placeholder="e.g. Diljit Dosanjh" class="w-full p-2 rounded-lg focus:outline-none focus:border-[#DB2777]">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">MP3 URL (Link)</label>
                        <input type="text" id="url" required placeholder="https://example.com/song.mp3" class="w-full p-2 rounded-lg focus:outline-none focus:border-[#DB2777]">
                        <p class="text-xs text-gray-500 mt-1">*Since no PHP, paste direct link to MP3</p>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Album Art URL (Link)</label>
                        <input type="text" id="albumArt" value="https://i.supaimg.com/c195cd6a-f837-4a7d-aceb-82d207dc69a7.jpg" class="w-full p-2 rounded-lg focus:outline-none focus:border-[#DB2777]">
                    </div>
                </div>

                <button type="submit" class="bg-[#DB2777] hover:bg-pink-600 text-white px-6 py-2 rounded-lg font-bold transition w-full md:w-auto">
                    Add to List
                </button>
            </form>
        </div>

        <!-- Song List Table -->
        <div class="glass-card p-6 rounded-2xl">
            <h2 class="text-xl font-semibold mb-4">Current Playlist Preview</h2>
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm text-gray-400">
                    <thead class="text-xs uppercase bg-white/5 text-gray-200">
                        <tr>
                            <th class="px-4 py-3">Art</th>
                            <th class="px-4 py-3">Title</th>
                            <th class="px-4 py-3">Artist</th>
                            <th class="px-4 py-3 text-right">Action</th>
                        </tr>
                    </thead>
                    <tbody id="songListBody">
                        <!-- Javascript will load rows here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let songs = [];

        // 1. Load existing songs.json on startup
        async function loadExistingSongs() {
            try {
                const response = await fetch('songs.json?v=' + new Date().getTime());
                if (!response.ok) throw new Error("File not found");
                songs = await response.json();
                renderList();
            } catch (error) {
                console.log("Creating new list because songs.json wasn't found or empty.");
                songs = [];
            }
        }

        // 2. Render the list in HTML table
        function renderList() {
            const tbody = document.getElementById('songListBody');
            tbody.innerHTML = '';

            songs.forEach((song, index) => {
                const row = `
                    <tr class="border-b border-white/5 hover:bg-white/5">
                        <td class="px-4 py-3">
                            <img src="${song.albumArt}" class="w-10 h-10 rounded object-cover" onerror="this.src='https://via.placeholder.com/40'">
                        </td>
                        <td class="px-4 py-3 text-white font-medium">${song.title}</td>
                        <td class="px-4 py-3">${song.artist}</td>
                        <td class="px-4 py-3 text-right">
                            <button onclick="deleteSong(${index})" class="text-red-400 hover:text-red-300">Delete</button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // 3. Add Song Function
        document.getElementById('songForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const newSong = {
                title: document.getElementById('title').value,
                artist: document.getElementById('artist').value,
                url: document.getElementById('url').value,
                albumArt: document.getElementById('albumArt').value
            };

            // Add to TOP of list
            songs.unshift(newSong);
            
            // Clear inputs
            document.getElementById('title').value = '';
            document.getElementById('artist').value = '';
            document.getElementById('url').value = '';
            
            renderList();
            alert("Song added to list! Click 'Download Updated songs.json' when finished.");
        });

        // 4. Delete Song Function
        function deleteSong(index) {
            if(confirm('Remove this song from list?')) {
                songs.splice(index, 1);
                renderList();
            }
        }

        // 5. Download the JSON file (THE MOST IMPORTANT PART)
        function downloadJSON() {
            const dataStr = JSON.stringify(songs, null, 2); // Convert array to JSON string
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = "songs.json";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Initialize
        loadExistingSongs();
    </script>
</body>
</html>
